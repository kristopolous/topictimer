<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
  </head>
<style>
body { 
  font-family: 'Fjalla One', sans-serif;
  margin: 0; padding: 0}
#template { display: none }
.topic { width: 100%;
  display: flex;
  font-size: 5rem;
  opacity: 0.7;
  position: relative;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  border-bottom: 1px solid black;
}
#timer {
  position: absolute;
  font-size: 2rem;
  top: 0;
  font-weight: 800;
  font-family: 'Source Code Pro', monospace;
  left: 10px;
}
.bg {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0.8;
  z-index: -1;
  width: 100%;
  height: 0;
}
</style>
  <body>
    <div id=timer> </div>
    <div id=timeline>
    </div>
    <div id=template>
      <script type=text/plain id=template-row>
        <div class=topic style="color:<%=fg%>;height:<%= height %>px">
        <div class=bg style=background-color:<%=bg%>></div>
        <%= topic %>
        </div>
      </script>
    </div>
  </body>
<script src=underscore-min.js></script>
<script>
  var timer,topicList = [ 
    ['show name', 60],
    ['theme song', 120],
    ['store closed', 90],
    ['tax software', 120],
    ['theme software', 120],
    ['sold car', 180],
    ['audio hardware', 90],
    ['podbean', 90],
    ["no politics", 60],
    ["don't sell stuff", 60],
    ["show numbers", 60]
  ], mult = 1.5, show = 0;

function hsl2Rgb(h, s, l){
    var r, g, b;

    if(s == 0){
        r = g = b = l; // achromatic
    }else{
        var hue2rgb = function hue2rgb(p, q, t){
            if(t < 0) t += 1;
            if(t > 1) t -= 1;
            if(t < 1/6) return p + (q - p) * 6 * t;
            if(t < 1/2) return q;
            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        }

        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        var p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
    }

    return 'rgb(' + [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)].join(',') + ')';
}

function toDom(html) {
  var template = document.createElement('template');
  html = html.trim(); 
  template.innerHTML = html;
  return template.content.firstChild;
}

function play() {
  var ix = 0, iy = 0, ttl = 0, start = new Date(), incr = 1/mult;
  var ival = setInterval(function() {
    iy += incr;
    ttl += incr;
    if(iy > topicList[ix][1]) {
      iy = 0;
      ix++;
      if(ix >= topicList.length) {
        clearInterval(ival);
        return;
      }
    }
    var lapse = (new Date() - start) / 1000;
    var str = [ 
      ("" + (100 + Math.floor(lapse / 60 / 60))).slice(1),
      ("" + (100 + Math.floor(lapse / 60 ) % 60)).slice(1),
      ("" + (100 + Math.floor(lapse) % 60)).slice(1)
    ].join(':');
    timer.innerHTML = str;
    timer.style.top = (mult * ttl) - 20 + "px";
    topicList[ix][2].querySelector('.bg').style.height = (mult * iy) + "px";
    window.scroll(0, (mult * ttl) - 300); 
  }, 1000 / mult);
}

function generate() {
  var tpl = _.template(document.querySelector('#template-row').innerHTML)
  var ix = Math.random() * 10;
  topicList.forEach(row => {
    var color = (Math.random() * 0.1 + 0.15 * ix);
    color = color - Math.floor(color);
    var bg = hsl2Rgb(color, .95, .7);
    var fg = hsl2Rgb(color, .5, .3);
    var dom = toDom(tpl({fg: fg, bg: bg, topic: row[0], height: mult * row[1]}));
    row.push(dom);
    document.querySelector("#timeline").appendChild(dom);
    show += row[1];
    ix++;
  });
  console.log(show / 60);
  timer = document.querySelector('#timer');
  play();
}
window.onload = generate;
</script>
</html>
